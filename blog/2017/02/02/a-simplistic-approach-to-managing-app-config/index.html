<!doctype html><html lang=en><head><title>A simplistic approach to managing app config :: Nick Ebbitt</title>
<meta charset=utf-8><meta name=viewport content="width=device-width,initial-scale=1"><meta name=description content="I&rsquo;ve recently been involved in the transformation of the processes used to deliver change from being heavily manual, time consuming and error prone to fully automated, efficient and reliable.
To drive the new automated process without human interaction, other than maybe clicking a single button, we knew that we would need a way of managing application configuration that allowed the process to simply pick up the config values during its execution. Our automated deployment process was driven by bash scripts so compatibility with bash was desirable.
"><meta name=keywords content><meta name=robots content="noodp"><link rel=canonical href=https://www.nickebbitt.com/blog/2017/02/02/a-simplistic-approach-to-managing-app-config/><link rel=stylesheet href=https://www.nickebbitt.com/styles.css><link rel="shortcut icon" href=https://www.nickebbitt.com/img/theme-colors/green.png><link rel=apple-touch-icon href=https://www.nickebbitt.com/img/theme-colors/green.png><meta name=twitter:card content="summary"><meta name=twitter:site content="nickebbitt"><meta name=twitter:creator content><meta property="og:locale" content="en"><meta property="og:type" content="article"><meta property="og:title" content="A simplistic approach to managing app config"><meta property="og:description" content="I&rsquo;ve recently been involved in the transformation of the processes used to deliver change from being heavily manual, time consuming and error prone to fully automated, efficient and reliable.
To drive the new automated process without human interaction, other than maybe clicking a single button, we knew that we would need a way of managing application configuration that allowed the process to simply pick up the config values during its execution. Our automated deployment process was driven by bash scripts so compatibility with bash was desirable.
"><meta property="og:url" content="https://www.nickebbitt.com/blog/2017/02/02/a-simplistic-approach-to-managing-app-config/"><meta property="og:site_name" content="Nick Ebbitt"><meta property="og:image" content="https://www.nickebbitt.com/img/favicon/green.png"><meta property="og:image:width" content="1200"><meta property="og:image:height" content="627"><meta property="article:published_time" content="2017-02-02 00:00:00 +0000 UTC"></head><body class=green><div class="container headings--one-size"><header class=header><div class=header__inner><div class=header__logo><a href=/posts><div class=logo>Nick Ebbitt</div></a></div><ul class="menu menu--mobile"><li class=menu__trigger>Menu&nbsp;▾</li><li><ul class=menu__dropdown><li><a href=/about>About</a></li><li><a href=/contact>Contact</a></li><li><a href=/posts>Posts</a></li></ul></li></ul></div><nav class=navigation-menu><ul class="navigation-menu__inner menu--desktop"><li><a href=/about>About</a></li><li><a href=/contact>Contact</a></li><li><a href=/posts>Posts</a></li></ul></nav></header><div class=content><article class=post><h1 class=post-title><a href=https://www.nickebbitt.com/blog/2017/02/02/a-simplistic-approach-to-managing-app-config/>A simplistic approach to managing app config</a></h1><div class=post-meta><time class=post-date>2017-02-02 ::
</time><span class=post-reading-time>:: 5 min read (967 words)</span></div><div class=post-content><div><p>I&rsquo;ve recently been involved in the transformation of the processes used to deliver change from being heavily manual, time consuming and error prone to fully automated, efficient and reliable.</p><p>To drive the new automated process without human interaction, other than maybe clicking a single button, we knew that we would need a way of managing application configuration that allowed the process to simply pick up the config values during its execution. Our automated deployment process was driven by bash scripts so compatibility with bash was desirable.</p><p>There were two types of config we had to deal with:</p><ul><li>Deployment - which components go where etc.</li><li>Application - runtime parameters e.g. JDBC connection params</li></ul><p>An additional complication to the management of config was due to the nature of our business with us hosting multiple deployments of the same product for different customers, up to around 20. This meant that the following dimensions had to be considered when deciding how to manage the config params:</p><ul><li>Product</li><li>Customer</li><li>Environment e.g. development (DEV), integration testing (IT), user acceptance testing (UAT), production (PROD)</li><li>Version</li></ul><p>We also decided that it was important to have an audit trail of changes to the config to help with the analysis and debug of any issues that may arise.</p><p>This would all be tied together through a Jenkins job where any preparation of the config could be performed and an artifact created to ease consumption by other Jenkins jobs.</p><p>So to summarise, our requirements were:</p><ul><li>Compatibility with automated deployment process i.e. consumable by shell scripts (Bash)</li><li>Support multiple customers, products, environments and versions</li><li>Audit of changes to config</li></ul><h2 id=the-solution>The Solution<a href=#the-solution class=hanchor arialabel=Anchor>&#8983;</a></h2><p>The only tools you&rsquo;ll need for this solution are a shell environment (i.e. Bash), your favourite file editor and Git.</p><h3 id=shell-compatibility>Shell compatibility<a href=#shell-compatibility class=hanchor arialabel=Anchor>&#8983;</a></h3><p>Starting with the first requirement, the need for the config to be consumable by shell scripts, we opted to define a set of key/value pairs in the form of Linux environment variables in a shell script called <code>params.sh</code>, for example:</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>MY_PARAM1<span style=color:#f92672>=</span>value1
</span></span><span style=display:flex><span>MY_PARAM2<span style=color:#f92672>=</span>value2
</span></span></code></pre></div><p>This provides a very simple way to inject parameter values into the process performing the application deployment. This could be via a Jenkins job or simply by sourcing the params file into another shell script e.g.</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>source params.sh
</span></span></code></pre></div><h3 id=support-for-multiple-customers-products-environments-and-versions>Support for multiple customers, products, environments and versions<a href=#support-for-multiple-customers-products-environments-and-versions class=hanchor arialabel=Anchor>&#8983;</a></h3><p>Addressing the second requirement, to support the provision of config files for multiple customers, products, environments and versions, we had to find a way of organising the config is such a way to make it easily accessible.</p><p>The options boiled down to preferring the config to be accessible first by customer then product or by product then customer. To illustrate this the directory structures for storing the config of each option would be:</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span><span style=color:#75715e># Customer -&gt; Product -&gt; Environment -&gt; Version</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>CUST1
</span></span><span style=display:flex><span>../PRODUCT1
</span></span><span style=display:flex><span>..../UAT
</span></span><span style=display:flex><span>....../1.0.0
</span></span><span style=display:flex><span>....../1.1.0
</span></span><span style=display:flex><span>......../params.sh
</span></span><span style=display:flex><span>..../PROD
</span></span><span style=display:flex><span>....../1.0.0
</span></span><span style=display:flex><span>......../params.sh
</span></span><span style=display:flex><span>../PRODUCT2
</span></span><span style=display:flex><span>CUST2
</span></span><span style=display:flex><span>...
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e># Product -&gt; Customer -&gt; Environment -&gt; Version</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>PRODUCT1
</span></span><span style=display:flex><span>../CUST1
</span></span><span style=display:flex><span>..../UAT
</span></span><span style=display:flex><span>....../1.0.0
</span></span><span style=display:flex><span>....../1.1.0
</span></span><span style=display:flex><span>......../params.sh
</span></span><span style=display:flex><span>..../PROD
</span></span><span style=display:flex><span>....../1.0.0
</span></span><span style=display:flex><span>......../params.sh
</span></span><span style=display:flex><span>../CUST2
</span></span><span style=display:flex><span>PRODUCT2
</span></span><span style=display:flex><span>...
</span></span></code></pre></div><p>To be honest it was six of one, half a dozen of the other as to which structure would be better. We went with the first option, customer then product, mainly due to the fact that then for a single customer we would have all of their config grouped together. As mentioned though there are arguments just as strong the other way.</p><p>So now we have the ability to source a parameter file into a Bash script that will be held in a directory structure such as <code>./CUST1/PRODUCT1/UAT/1.1.0/params.sh</code>.</p><h3 id=auditing>Auditing<a href=#auditing class=hanchor arialabel=Anchor>&#8983;</a></h3><p>Finally, to meet the requirement of having an audit log of all config related changes we simply host the above file structure and parameter files in a Git repo.</p><p>Whenever we need create or update create a new Git commit and push the change to the central Git repo. A Jenkins job will then clone the repo and create an artifact (i.e. tar file) containing all config that can then be consumed by other processes (i.e. other Jenkins jobs).</p><p>As we are using Git we also include an audit log in the artifact to make it easier to reference the changes made to the config wherever they are being used. This is achieved with via the <code>git log</code> command with some special formatting:</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>git log --pretty<span style=color:#f92672>=</span>format:<span style=color:#e6db74>&#34;%h - %an (%ae), %ad : %s&#34;</span> &gt; commit.log
</span></span></code></pre></div><p>This produces output such as:</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>e3e0728 - Nick Ebbitt <span style=color:#f92672>(</span>someone@gmail.com<span style=color:#f92672>)</span>, Mon Jan <span style=color:#ae81ff>30</span> 20:34:11 <span style=color:#ae81ff>2017</span> +0000 : Fix grammatical error
</span></span><span style=display:flex><span>81826b4 - Nick Ebbitt <span style=color:#f92672>(</span>someone@gmail.com<span style=color:#f92672>)</span>, Wed Jan <span style=color:#ae81ff>25</span> 13:58:48 <span style=color:#ae81ff>2017</span> +0000 : Reword introduction
</span></span><span style=display:flex><span>af7a186 - Nick Ebbitt <span style=color:#f92672>(</span>someone@gmail.com<span style=color:#f92672>)</span>, Wed Jan <span style=color:#ae81ff>4</span> 21:03:44 <span style=color:#ae81ff>2017</span> +0000 : Add Amazon Linux to tech skills
</span></span><span style=display:flex><span>167244c - Nick Ebbitt <span style=color:#f92672>(</span>someone@gmail.com<span style=color:#f92672>)</span>, Wed Jan <span style=color:#ae81ff>4</span> 10:04:22 <span style=color:#ae81ff>2017</span> +0000 : Update footer to <span style=color:#ae81ff>2017</span>
</span></span><span style=display:flex><span>61ef2f7 - Nick Ebbitt <span style=color:#f92672>(</span>someone@gmail.com<span style=color:#f92672>)</span>, Tue Jan <span style=color:#ae81ff>3</span> 21:06:32 <span style=color:#ae81ff>2017</span> +0000 : Update photo on main page
</span></span><span style=display:flex><span>5fa1a83 - Nick Ebbitt <span style=color:#f92672>(</span>someone@gmail.com<span style=color:#f92672>)</span>, Tue Jan <span style=color:#ae81ff>3</span> 19:19:07 <span style=color:#ae81ff>2017</span> +0000 : Update technical skills on CV
</span></span></code></pre></div><h2 id=final-thoughts>Final thoughts&mldr;<a href=#final-thoughts class=hanchor arialabel=Anchor>&#8983;</a></h2><p>So that&rsquo;s it. As in the title, this is a very simplistic approach that may not stand the test of the time but it works quite well for our basic needs right now.</p><p>Currently this solution doesn&rsquo;t provide a way for app components to discover their config or receive config changes at runtime however without too much effort this solution could be reworked to play nicely with <a href=https://cloud.spring.io/spring-cloud-config/>Spring Cloud Config</a> or an equivalent tool.</p><p>The solution could also benefit from some kind inheritance model to reduce duplication. There are undoubtedly a common set of defaults values that rarely change across customers.</p><p>Arguably we could also do away with the version dimension as we will likely always be delivering the latest version for which the config must be compatible. We would therefore have a single set of config params for each customer / product / environment further reducing duplication.</p></div></div><div class=pagination><div class=pagination__title><span class=pagination__title-h>Read other posts</span><hr></div><div class=pagination__buttons><span class="button previous"><a href=https://www.nickebbitt.com/blog/2017/02/13/tdd-sudoku-and-a-mob/><span class=button__icon>←</span>
<span class=button__text>TDD, Sudoku and a mob!</span>
</a></span><span class="button next"><a href=https://www.nickebbitt.com/blog/2017/01/01/making-a-mockery-of-web-services/><span class=button__text>Making a mockery of web services</span>
<span class=button__icon>→</span></a></span></div></div></article></div><footer class=footer><div class=footer__inner><div class=copyright><span>© 2024 Powered by <a href=http://gohugo.io>Hugo</a></span>
<span>:: Theme made by <a href=https://twitter.com/panr>panr</a></span></div></div></footer><script type=text/javascript src=/bundle.min.js></script></div></body></html>